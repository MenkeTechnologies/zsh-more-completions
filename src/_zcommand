#compdef z

local arguments

exists(){
    #alternative is command -v
    type "$1" &>/dev/null || return 1 && \
    type "$1" 2>/dev/null | \
    command grep -qv "suffix alias" 2>/dev/null
}


arguments=(
       '-c[restrict matches to subdirectories of the current directory]'
       '-e[echo the best match, do not cd]'
       '-c[show a brief help message]'
       '-l[list only]'
       '-r[match by rank only]'
       '-t[match by recent access only]'
       '-x[remove the current directory from the datafile]'
        '1:command:->command'
        '*::options:->options'
)

local curcontext="$curcontext" state state_descr line expl
local tmp ret=1

if exists zshz; then
    __display(){
            _alternative 'zdir:z ranked directories:(('"$(zshz -l 2>/dev/null | perl -ne 'print reverse <>' | awk -v q=\' '{printf "%s\\:\"%s\" ", $2,$1}')"'))' \
            'files:directory:_path_files -g ".*(/) *(/)"'
    }

elif exists _z; then
    __display(){
            _alternative 'zdir:z ranked directories:(('"$(_z -l |& perl -ne 'print reverse <>' | awk -v q=\' '{printf "%s\\:\"%s\" ", $2,$1}')"'))' \
            'files:directory:_path_files -g ".*(/) *(/)"'
    }
else
    return 1
fi

_arguments -s -C : $arguments && return 0

case "$state" in
    command)
        __display && return 0
        ;;
    options)
        _message "no more arguments for z"
        return 1
        ;;
esac

